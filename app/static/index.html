<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Oaktree Variance Drafts</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 16px; max-width: 480px; }
    label { display: block; margin-top: 12px; }
    input[type="file"], input[type="number"] { width: 100%; }
    button { margin-top: 16px; padding: 10px 16px; }
    .variance { padding: 8px 0; border-bottom: 1px solid #ddd; }
    .variance p { margin: 4px 0; }
    pre { white-space: pre-wrap; }
  </style>
</head>
<body>
  <h1>Upload CSVs</h1>
  <form id="form">
    <label>Budgetâ€“Actuals CSV
      <input type="file" name="budget_actuals" accept=".csv" required>
    </label>
    <label>Change Orders CSV
      <input type="file" name="change_orders" accept=".csv" required>
    </label>
    <label>Vendor Map CSV
      <input type="file" name="vendor_map" accept=".csv" required>
    </label>
    <label>Category Map CSV
      <input type="file" name="category_map" accept=".csv" required>
    </label>
    <label>Materiality %
      <input type="number" name="materiality_pct" value="5">
    </label>
    <label>Materiality amount (SAR)
      <input type="number" name="materiality_amount_sar" value="100000">
    </label>
    <label><input type="checkbox" name="bilingual" checked> Bilingual</label>
    <label><input type="checkbox" name="enforce_no_speculation" checked> No speculation</label>
    <label>API Key
      <input type="password" name="api_key">
    </label>
    <button type="submit">Generate</button>
  </form>
  <div id="out"></div>
  <script>
    const form = document.getElementById('form');
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const out = document.getElementById('out');
      out.textContent = 'Processing...';
      try {
        const data = new FormData(form);
        const resp = await fetch('/upload', { method: 'POST', body: data });
        if (!resp.ok) {
          const text = await resp.text();
          out.textContent = `Error: ${resp.status} ${text}`;
          return;
        }
        const json = await resp.json();
        if (!Array.isArray(json)) {
          out.textContent = `Unexpected response: ${JSON.stringify(json)}`;
          return;
        }
        out.innerHTML = '';
        json.forEach(item => {
          const div = document.createElement('div');
          div.className = 'variance';
          div.innerHTML = `<p><strong>EN:</strong> ${item.draft_en}</p>` +
            (item.draft_ar ? `<p><strong>AR:</strong> ${item.draft_ar}</p>` : '');
          out.appendChild(div);
        });
      } catch (err) {
        out.textContent = `Error: ${err.message}`;
      }
    });
  </script>
</body>
</html>
